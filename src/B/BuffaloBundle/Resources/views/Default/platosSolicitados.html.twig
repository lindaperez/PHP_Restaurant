{% extends 'layout.html.twig' %}

{% block content %}

    <h1 class="title">Reportes </h1>
    
<script src="{{ asset('bundles/techt/js/highcharts.js') }}" type="text/javascript"></script>
<script src="{{ asset('bundles/techt/js/exporting.js') }}" type="text/javascript"></script>

    
       
    {% if app.session.get('usuario_estatus_registro')=="Solicitud de Registro" %}
    <h2 class="title">Acceso Restringido Temporal.</h2> 
    <h3 class="title">Por ahora no podrá realizar algunas funciones 
        en el sistema, debe esperar el correo de confirmacion de Registro para 
       que se muestren las opciones que puede usar como cliente de techtrol, muchas gracias.</h3>
    {% endif %}
    

<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
<script>
    $(function () {
        
        var data = {
                     //   tbgentiposolicitud_id: $(this).val()
                    };

                    $.ajax({
                        type: 'post',
                        url: '{{ path("maxplatos") }}',
                        data: data,
                        dataType: 'json',
                        success: function(data) {
                            if (data.error !== undefined && data.error !== '') {
                                alert(data.error);
                            } else {
                                if (data.length!== undefined ){
                                    var values=new Array();
                                    var name=new Array();
                                    var dia=data[0].dia;
                                    var mes=data[0].mes;
                                    var ano=data[0].ano;
                                    for (var i=0, total = data.length; i < total; i++) {
                                        values[i]=[Date.UTC(data[i].ano, (data[i].mes-1),
                                            data[i].dia),data[i].cant];
                                        name[i]=data[i].name;
                                  //     alert(values[i]);
                                    }
                                                                    
        $('#container').highcharts({
            
            chart: {
                zoomType: 'x'
            },
            title: {
                text: 'Platos Más Solicitadados'
            },
            subtitle: {
                
                text: document.ontouchstart === undefined ?
                    'Haz click de un punto a otro encima del\n\
                        grafico para ver la zona seleccionada en zoom' :
                    'Haz click de un punto a otro encima del \n\
                        grafico para ver la zona seleccionada en zoom'
            },
            xAxis: {
                type: 'datetime',
                minRange: 16 * 24 * 3600000,
                text: 'Meses'// fourteen days
            },
            yAxis: {
                title: {
                    text: 'Número de Peticiones'
                }
            },
            tooltip: {
                formatter: function(){
                    return '<b> Cantidad: '+ this.point.y +'</b><br/>'+
                        'Plato: '+ this.series.name[this.point.y]+ '<br>\n\
                        Fecha de Compra: '+ Highcharts.dateFormat('%d-%m-%Y', this.point.x);
                }
            },
            legend: {
                enabled: false,
                
            },
            plotOptions: {
                area: {
                    fillColor: {
                        linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1},
                        stops: [
                            [0, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                        ]
                    },
                    marker: {
                        radius: 4
                    },
                    lineWidth: 1,
                    states: {
                        hover: {
                            lineWidth: 1
                        }
                    },
                    threshold: null
                }
            },
    
            series: [{
                type: 'area',
                name: name,
                pointInterval: 24 * 3600 * 1000,
                pointStart: Date.UTC(ano, mes-1, dia),
                data: values
            }]
        });
                                }else{
                                    alert('No Data');
                                }
                            }
                        },
                        error: function(e, ts, et) {
                            alert(ts);
                            
                        }
                    });
        
                            
        
    
    });
    

    </script>
{% endblock %}
